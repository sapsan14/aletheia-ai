# MOCK_TSA ‚Äî –¥–µ—Ç–µ—Ä–º–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Å–∏–º—É–ª—è—Ç–æ—Ä TSA –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

**–î–µ—Ç–µ—Ä–º–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –∏–º–ø–ª–µ–º–µ–Ω—Ç–∞—Ü–∏—è RFC 3161 Time-Stamp Authority –¥–ª—è –ø–æ–≤—Ç–æ—Ä—è–µ–º—ã—Ö —Ç–µ—Å—Ç–æ–≤.**

---

## –°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ

- [–ó–∞—á–µ–º –Ω—É–∂–µ–Ω MOCK_TSA](#–∑–∞—á–µ–º-–Ω—É–∂–µ–Ω-mock_tsa)
- [–¶–µ–ª—å –∏ –ø—Ä–∏–Ω—Ü–∏–ø —Ä–∞–±–æ—Ç—ã](#—Ü–µ–ª—å-–∏-–ø—Ä–∏–Ω—Ü–∏–ø-—Ä–∞–±–æ—Ç—ã)
- [–ö–ª—é—á–µ–≤–∞—è –∏–¥–µ—è](#–∫–ª—é—á–µ–≤–∞—è-–∏–¥–µ—è)
- [–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞](#–∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞)
- [–ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –∫–æ–Ω—Ç—Ä–∞–∫—Ç](#–º–∏–Ω–∏–º–∞–ª—å–Ω—ã–π-–∫–æ–Ω—Ç—Ä–∞–∫—Ç)
- [–§–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã](#—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ-—ç–ª–µ–º–µ–Ω—Ç—ã)
  - [–§–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –≤—Ä–µ–º—è](#—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ-–≤—Ä–µ–º—è)
  - [–î–µ—Ç–µ—Ä–º–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–π serialNumber](#–¥–µ—Ç–µ—Ä–º–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–π-serialnumber)
  - [–î–µ—Ç–µ—Ä–º–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –ø–æ–¥–ø–∏—Å—å](#–¥–µ—Ç–µ—Ä–º–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω–∞—è-–ø–æ–¥–ø–∏—Å—å)
- [–ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è RFC 3161 —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –æ—Ç–≤–µ—Ç–∞](#–º–∏–Ω–∏–º–∞–ª—å–Ω–∞—è-rfc-3161-—Å—Ç—Ä—É–∫—Ç—É—Ä–∞-–æ—Ç–≤–µ—Ç–∞)
- [–ü—Ä–∏–º–µ—Ä –∏–º–ø–ª–µ–º–µ–Ω—Ç–∞—Ü–∏–∏ (–ø—Å–µ–≤–¥–æ–∫–æ–¥)](#–ø—Ä–∏–º–µ—Ä-–∏–º–ø–ª–µ–º–µ–Ω—Ç–∞—Ü–∏–∏-–ø—Å–µ–≤–¥–æ–∫–æ–¥)
- [–ß—Ç–æ –º–æ–∂–Ω–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å —Å MOCK_TSA](#—á—Ç–æ-–º–æ–∂–Ω–æ-—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å-—Å-mock_tsa)
- [–ö–ª—é—á–µ–≤–∞—è —Ñ–∏–ª–æ—Å–æ—Ñ–∏—è](#–∫–ª—é—á–µ–≤–∞—è-—Ñ–∏–ª–æ—Å–æ—Ñ–∏—è)
- [–û—Ç–ª–∏—á–∏—è –æ—Ç —Ä–µ–∞–ª—å–Ω–æ–≥–æ TSA](#–æ—Ç–ª–∏—á–∏—è-–æ—Ç-—Ä–µ–∞–ª—å–Ω–æ–≥–æ-tsa)
- [–ü–∞—Ç—Ç–µ—Ä–Ω: Cryptographic Test Oracle](#–ø–∞—Ç—Ç–µ—Ä–Ω-cryptographic-test-oracle)
- [–ò–º–ø–ª–µ–º–µ–Ω—Ç–∞—Ü–∏—è –Ω–∞ Java (Bouncy Castle)](#–∏–º–ø–ª–µ–º–µ–Ω—Ç–∞—Ü–∏—è-–Ω–∞-java-bouncy-castle)
  - [–ü–æ—á–µ–º—É Java –¥–ª—è Aletheia](#–ø–æ—á–µ–º—É-java-–¥–ª—è-aletheia)
  - [–ö–æ–Ω—Ç—Ä–∞–∫—Ç: –±–µ–∑ —Å–µ—Ç–∏, —Ç–æ–ª—å–∫–æ —Å–µ—Ä–≤–∏—Å](#–∫–æ–Ω—Ç—Ä–∞–∫—Ç-–±–µ–∑-—Å–µ—Ç–∏-—Ç–æ–ª—å–∫–æ-—Å–µ—Ä–≤–∏—Å)
  - [–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏](#–∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏)
  - [–†–∞–±–æ—á–∞—è –ª–æ–≥–∏–∫–∞ —Å Bouncy Castle](#—Ä–∞–±–æ—á–∞—è-–ª–æ–≥–∏–∫–∞-—Å-bouncy-castle)
  - [–ì–¥–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≤ –ø—Ä–æ–µ–∫—Ç–µ](#–≥–¥–µ-–∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å-–≤-–ø—Ä–æ–µ–∫—Ç–µ)
  - [Golden fixtures (–±–∞–π—Ç-–≤-–±–∞–π—Ç)](#golden-fixtures-–±–∞–π—Ç-–≤-–±–∞–π—Ç)
- [–î–∞–ª—å–Ω–µ–π—à–∏–µ —à–∞–≥–∏ (Task 2.4)](#–¥–∞–ª—å–Ω–µ–π—à–∏–µ-—à–∞–≥–∏-task-24)
- [–°–≤—è–∑–∞–Ω–Ω—ã–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã](#—Å–≤—è–∑–∞–Ω–Ω—ã–µ-–¥–æ–∫—É–º–µ–Ω—Ç—ã)

---

## –ó–∞—á–µ–º –Ω—É–∂–µ–Ω MOCK_TSA

MOCK_TSA —Ä–µ—à–∞–µ—Ç —Ñ—É–Ω–¥–∞–º–µ–Ω—Ç–∞–ª—å–Ω—É—é –ø—Ä–æ–±–ª–µ–º—É —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∫—Ä–∏–ø—Ç–æ–≥—Ä–∞—Ñ–∏—á–µ—Å–∫–∏—Ö —Å–∏—Å—Ç–µ–º —Å –≤—Ä–µ–º–µ–Ω–Ω—ã–º–∏ –º–µ—Ç–∫–∞–º–∏:

**–ü—Ä–æ–±–ª–µ–º–∞:** –†–µ–∞–ª—å–Ω—ã–π TSA –ø–æ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—é **–Ω–µ–¥–µ—Ç–µ—Ä–º–∏–Ω–∏—Ä–æ–≤–∞–Ω**:
- –ö–∞–∂–¥—ã–π –∑–∞–ø—Ä–æ—Å –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —É–Ω–∏–∫–∞–ª—å–Ω–æ–µ –≤—Ä–µ–º—è (—Ä–µ–∞–ª—å–Ω—ã–µ —á–∞—Å—ã)
- –ü–æ–¥–ø–∏—Å—å —Å–æ–¥–µ—Ä–∂–∏—Ç —Å–ª—É—á–∞–π–Ω—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã (padding, nonce)
- –¢—Ä–µ–±—É–µ—Ç —Å–µ—Ç–µ–≤–æ–≥–æ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –≤–Ω–µ—à–Ω–µ–º—É —Å–µ—Ä–≤–∏—Å—É
- –†–µ–∑—É–ª—å—Ç–∞—Ç –º–µ–Ω—è–µ—Ç—Å—è –ø—Ä–∏ –∫–∞–∂–¥–æ–º –∑–∞–ø—É—Å–∫–µ —Ç–µ—Å—Ç–∞

**–†–µ—à–µ–Ω–∏–µ:** MOCK_TSA ‚Äî –ø–æ–ª–Ω–æ—Å—Ç—å—é **–¥–µ—Ç–µ—Ä–º–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–π** —Å–∏–º—É–ª—è—Ç–æ—Ä:
- –í—Å–µ–≥–¥–∞ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –æ–¥–∏–Ω–∞–∫–æ–≤—ã–π —Ç–æ–∫–µ–Ω –¥–ª—è –æ–¥–∏–Ω–∞–∫–æ–≤–æ–≥–æ –≤—Ö–æ–¥–∞
- –ù–µ –∑–∞–≤–∏—Å–∏—Ç –æ—Ç —Ä–µ–∞–ª—å–Ω–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏
- –ù–µ —Ç—Ä–µ–±—É–µ—Ç —Å–µ—Ç–∏ –∏–ª–∏ –≤–Ω–µ—à–Ω–∏—Ö —Å–µ—Ä–≤–∏—Å–æ–≤
- –ì–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç –ø–æ–≤—Ç–æ—Ä—è–µ–º–æ—Å—Ç—å —Ç–µ—Å—Ç–æ–≤

**–í—ã–≤–æ–¥:**
```
–†–µ–∞–ª—å–Ω—ã–π TSA = –Ω–µ–¥–µ—Ç–µ—Ä–º–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–π ‚Üí flaky tests
MOCK_TSA     = 100% –¥–µ—Ç–µ—Ä–º–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–π ‚Üí reproducible tests
```

---

## –¶–µ–ª—å –∏ –ø—Ä–∏–Ω—Ü–∏–ø —Ä–∞–±–æ—Ç—ã

### –¶–µ–ª—å

–î–ª—è –æ–¥–Ω–æ–≥–æ –∏ —Ç–æ–≥–æ –∂–µ –≤—Ö–æ–¥–∞:

```
hash + policy + nonce  ‚Üí  –≤—Å–µ–≥–¥–∞ –æ–¥–∏–Ω –∏ —Ç–æ—Ç –∂–µ TimeStampToken
```

### –ß—Ç–æ —É—Å—Ç—Ä–∞–Ω—è–µ—Ç—Å—è

MOCK_TSA —Ä–∞–±–æ—Ç–∞–µ—Ç **–±–µ–∑**:
- **–ß–∞—Å–æ–≤** ‚Äî –≤—Ä–µ–º—è —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–æ
- **–°–µ—Ç–∏** ‚Äî –≤—Å—ë –ª–æ–∫–∞–ª—å–Ω–æ, in-memory
- **–°–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤** ‚Äî –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è hardcoded —Ñ–∏–∫—Ç–∏–≤–Ω—ã–π —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç
- **Randomness** ‚Äî –≤—Å–µ —ç–ª–µ–º–µ–Ω—Ç—ã –¥–µ—Ç–µ—Ä–º–∏–Ω–∏—Ä–æ–≤–∞–Ω—ã

---

## –ö–ª—é—á–µ–≤–∞—è –∏–¥–µ—è

MOCK_TSA ‚Äî —ç—Ç–æ **–∫—Ä–∏–ø—Ç–æ–≥—Ä–∞—Ñ–∏—á–µ—Å–∫–∏–π —Å–∏–º—É–ª—è—Ç–æ—Ä**, –∞ –Ω–µ –Ω–∞—Å—Ç–æ—è—â–∏–π TSA.

–û–Ω –¥–µ–ª–∞–µ—Ç –≤–∏–¥, —á—Ç–æ –æ–Ω TSA, –Ω–æ –Ω–∞ —Å–∞–º–æ–º –¥–µ–ª–µ:

| –≠–ª–µ–º–µ–Ω—Ç | –†–µ–∞–ª—å–Ω—ã–π TSA | MOCK_TSA |
|---------|--------------|----------|
| –í—Ä–µ–º—è | `Date.now()` | –§–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ (`2026-01-01T00:00:00Z`) |
| –°–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç | –†–µ–∞–ª—å–Ω—ã–π X.509 –∏–∑ CA | –§–∏–∫—Ç–∏–≤–Ω—ã–π hardcoded cert |
| –ü–æ–¥–ø–∏—Å—å | –° –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º randomness | –î–µ—Ç–µ—Ä–º–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω–∞—è (RSA PKCS#1 v1.5) |
| ASN.1 —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ | –ü–æ–ª–Ω–æ—Å—Ç—å—é –≤–∞–ª–∏–¥–Ω–∞—è RFC 3161 | –ö–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è, –Ω–æ —É–ø—Ä–æ—â—ë–Ω–Ω–∞—è |

**–í–∞–∂–Ω–æ:** MOCK_TSA –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –≤–∞–ª–∏–¥–Ω—ã–µ RFC 3161 —Å—Ç—Ä—É–∫—Ç—É—Ä—ã ‚Äî –ø–∞—Ä—Å–µ—Ä—ã –∏ –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ç–æ—Ä—ã —Ä–∞–±–æ—Ç–∞—é—Ç —Å –Ω–∏–º –∫–∞–∫ —Å –Ω–∞—Å—Ç–æ—è—â–∏–º TSA.

---

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ   Test case          ‚îÇ
‚îÇ                      ‚îÇ
‚îÇ  hash = sha256(data) ‚îÇ
‚îÇ  nonce = 12345       ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
           ‚îÇ
           ‚îÇ TimeStampReq
           ‚îÇ (RFC 3161 request)
           ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ    MOCK_TSA          ‚îÇ
‚îÇ                      ‚îÇ
‚îÇ  ‚è∞ fixed time       ‚îÇ
‚îÇ  üîë fixed key        ‚îÇ
‚îÇ  ‚úçÔ∏è  deterministic   ‚îÇ
‚îÇ     signature        ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
           ‚îÇ
           ‚îÇ TimeStampResp
           ‚îÇ (RFC 3161 response)
           ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ Verification logic   ‚îÇ
‚îÇ                      ‚îÇ
‚îÇ  parse ASN.1         ‚îÇ
‚îÇ  verify signature    ‚îÇ
‚îÇ  extract genTime     ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

**–ü–æ—Ç–æ–∫:**
1. –¢–µ—Å—Ç —Å–æ–∑–¥–∞—ë—Ç RFC 3161 –∑–∞–ø—Ä–æ—Å (`TimeStampReq`) —Å —Ö–µ—à–µ–º –∏ nonce.
2. MOCK_TSA –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –∑–∞–ø—Ä–æ—Å ‚Äî –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –¥–µ—Ç–µ—Ä–º–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–π `TimeStampResp`.
3. –í–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏–æ–Ω–Ω–∞—è –ª–æ–≥–∏–∫–∞ –ø–∞—Ä—Å–∏—Ç –æ—Ç–≤–µ—Ç, –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –ø–æ–¥–ø–∏—Å—å, –∏–∑–≤–ª–µ–∫–∞–µ—Ç –≤—Ä–µ–º—è.

---

## –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –∫–æ–Ω—Ç—Ä–∞–∫—Ç

MOCK_TSA –¥–æ–ª–∂–µ–Ω —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å —Å–ª–µ–¥—É—é—â–∏–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å:

```typescript
interface MockTSA {
  /**
   * –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç RFC 3161 –∑–∞–ø—Ä–æ—Å –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –¥–µ—Ç–µ—Ä–º–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –æ—Ç–≤–µ—Ç.
   * 
   * @param request - TimeStampReq (ASN.1 DER –∏–ª–∏ –æ–±—ä–µ–∫—Ç)
   * @returns TimeStampResp (ASN.1 DER –∏–ª–∏ –æ–±—ä–µ–∫—Ç)
   */
  respond(request: TimeStampReq): TimeStampResp;
}
```

**–ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã –∫–æ–Ω—Ç—Ä–∞–∫—Ç–∞:**

```java
// Java
public interface MockTSA {
    TimeStampResponse respond(TimeStampRequest request);
}
```

```python
# Python
class MockTSA:
    def respond(self, request: TimeStampReq) -> TimeStampResp:
        pass
```

---

## –§–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã

–î–ª—è –æ–±–µ—Å–ø–µ—á–µ–Ω–∏—è –¥–µ—Ç–µ—Ä–º–∏–Ω–∏–∑–º–∞ —Å–ª–µ–¥—É—é—â–∏–µ —ç–ª–µ–º–µ–Ω—Ç—ã –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å **—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–º–∏**:

| –≠–ª–µ–º–µ–Ω—Ç | –ó–Ω–∞—á–µ–Ω–∏–µ | –ü—Ä–∏–º–µ—á–∞–Ω–∏–µ |
|---------|----------|------------|
| **TSA private key** | Hardcoded (PEM –∏–ª–∏ in-memory) | –û–¥–∏–Ω –∏ —Ç–æ—Ç –∂–µ –∫–ª—é—á –¥–ª—è –≤—Å–µ—Ö –∑–∞–ø—É—Å–∫–æ–≤ |
| **TSA certificate** | Hardcoded (X.509 DER) | –§–∏–∫—Ç–∏–≤–Ω—ã–π self-signed —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç |
| **Signing algorithm** | `sha256WithRSAEncryption` | RSA PKCS#1 v1.5 (–¥–µ—Ç–µ—Ä–º–∏–Ω–∏—Ä–æ–≤–∞–Ω) |
| **genTime** | `2026-01-01T00:00:00Z` | –§–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –≤—Ä–µ–º—è (Unix: `1767225600`) |
| **serialNumber** | –î–µ—Ç–µ—Ä–º–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–π (–∏–∑ hash + nonce) | –ù–∞–ø—Ä–∏–º–µ—Ä: `SHA256(messageImprint || nonce)[0..8]` |
| **nonce** | Echo –∏–∑ –∑–∞–ø—Ä–æ—Å–∞ | –ï—Å–ª–∏ –≤ –∑–∞–ø—Ä–æ—Å–µ –µ—Å—Ç—å nonce, –≤–æ–∑–≤—Ä–∞—â–∞–µ–º –µ–≥–æ –∂–µ |
| **policy** | –§–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–π OID | –ù–∞–ø—Ä–∏–º–µ—Ä: `1.2.3.4.5.6.7` (–ª—é–±–æ–π –≤–∞–ª–∏–¥–Ω—ã–π OID) |

---

### –§–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –≤—Ä–µ–º—è

**–ó–Ω–∞—á–µ–Ω–∏–µ:**
```
2026-01-01T00:00:00Z
```

**Unix timestamp:**
```
1767225600
```

**–ö—Ä–∏—Ç–∏—á–Ω–æ:** MOCK_TSA **–Ω–∏–∫–æ–≥–¥–∞** –Ω–µ –¥–æ–ª–∂–µ–Ω –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `Date.now()`, `System.currentTimeMillis()` –∏–ª–∏ –ª—é–±—ã–µ –¥—Ä—É–≥–∏–µ –∏—Å—Ç–æ—á–Ω–∏–∫–∏ —Ä–µ–∞–ª—å–Ω–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏.

**–ò–º–ø–ª–µ–º–µ–Ω—Ç–∞—Ü–∏—è:**

```javascript
// ‚ùå –ù–ï–ü–†–ê–í–ò–õ–¨–ù–û
const genTime = new Date();

// ‚úÖ –ü–†–ê–í–ò–õ–¨–ù–û
const genTime = new Date('2026-01-01T00:00:00Z');
```

```java
// ‚ùå –ù–ï–ü–†–ê–í–ò–õ–¨–ù–û
Instant genTime = Instant.now();

// ‚úÖ –ü–†–ê–í–ò–õ–¨–ù–û
Instant genTime = Instant.parse("2026-01-01T00:00:00Z");
```

---

### –î–µ—Ç–µ—Ä–º–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–π serialNumber

**–¶–µ–ª—å:** –î–ª—è –æ–¥–Ω–æ–≥–æ –∏ —Ç–æ–≥–æ –∂–µ `messageImprint + nonce` –≤—Å–µ–≥–¥–∞ –ø–æ–ª—É—á–∞—Ç—å –æ–¥–∏–Ω –∏ —Ç–æ—Ç –∂–µ `serialNumber`.

**–ü–æ–¥—Ö–æ–¥—ã:**

#### 1. –•–µ—à –æ—Ç –≤—Ö–æ–¥–∞ (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

```javascript
const serialNumber = SHA256(messageImprint + nonce).slice(0, 8);
```

–≠—Ç–æ –¥–∞—ë—Ç —É–Ω–∏–∫–∞–ª—å–Ω—ã–π, –Ω–æ –¥–µ—Ç–µ—Ä–º–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–π serial –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —É–Ω–∏–∫–∞–ª—å–Ω–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞.

#### 2. –§–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–π serial (–ø—Ä–æ—Å—Ç–æ–π –≤–∞—Ä–∏–∞–Ω—Ç –¥–ª—è —Ç–µ—Å—Ç–æ–≤)

```javascript
const serialNumber = BigInt(1);
```

–î–ª—è —Ç–µ—Å—Ç–æ–≤, –≥–¥–µ –Ω–µ –∫—Ä–∏—Ç–∏—á–Ω–∞ —É–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç—å serial, –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∫–æ–Ω—Å—Ç–∞–Ω—Ç—É `0x01`.

**ASN.1 –∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏–µ:**

```asn1
serialNumber INTEGER (8 bytes max)
```

---

### –î–µ—Ç–µ—Ä–º–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –ø–æ–¥–ø–∏—Å—å

**–ü—Ä–æ–±–ª–µ–º–∞:** –û–±—ã—á–Ω–∞—è RSA-–ø–æ–¥–ø–∏—Å—å –º–æ–∂–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å randomness –≤ padding —Å—Ö–µ–º–∞—Ö (–Ω–∞–ø—Ä–∏–º–µ—Ä, RSA-PSS).

**–†–µ—à–µ–Ω–∏–µ:** –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å **RSA PKCS#1 v1.5** ‚Äî –¥–µ—Ç–µ—Ä–º–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω—É—é —Å—Ö–µ–º—É –ø–æ–¥–ø–∏—Å–∏.

| –ê–ª–≥–æ—Ä–∏—Ç–º | –î–µ—Ç–µ—Ä–º–∏–Ω–∏—Ä–æ–≤–∞–Ω? | –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≤ MOCK_TSA? |
|----------|-----------------|--------------------------|
| **RSA PKCS#1 v1.5** (`sha256WithRSAEncryption`) | ‚úÖ –î–∞ | ‚úÖ **–î–∞** |
| RSA-PSS | ‚ùå –ù–µ—Ç (–∏—Å–ø–æ–ª—å–∑—É–µ—Ç random salt) | ‚ùå –ù–µ—Ç |
| ECDSA | ‚ùå –ù–µ—Ç (random k-value) | ‚ùå –ù–µ—Ç |

**OID –¥–ª—è `sha256WithRSAEncryption`:**
```
1.2.840.113549.1.1.11
```

**–ò–º–ø–ª–µ–º–µ–Ω—Ç–∞—Ü–∏—è (–ø—Å–µ–≤–¥–æ–∫–æ–¥):**

```javascript
const signature = sign(
  data,
  privateKey,
  {
    algorithm: 'sha256WithRSAEncryption', // RSA PKCS#1 v1.5
    padding: crypto.constants.RSA_PKCS1_PADDING
  }
);
```

**–í–∞–∂–Ω–æ:** –ü—Ä–∏ –∫–∞–∂–¥–æ–º –∑–∞–ø—É—Å–∫–µ —Å –æ–¥–Ω–∏–º –∏ —Ç–µ–º –∂–µ `data` –∏ `privateKey` –ø–æ–¥–ø–∏—Å—å –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å **–∏–¥–µ–Ω—Ç–∏—á–Ω–æ–π**.

---

## –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è RFC 3161 —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –æ—Ç–≤–µ—Ç–∞

MOCK_TSA –¥–æ–ª–∂–µ–Ω –≤–µ—Ä–Ω—É—Ç—å –≤–∞–ª–∏–¥–Ω—É—é ASN.1 —Å—Ç—Ä—É–∫—Ç—É—Ä—É:

```asn1
TimeStampResp ::= SEQUENCE {
  status         PKIStatusInfo,
  timeStampToken ContentInfo OPTIONAL
}

PKIStatusInfo ::= SEQUENCE {
  status        PKIStatus,
  statusString  UTF8String OPTIONAL,
  failInfo      PKIFailureInfo OPTIONAL
}

PKIStatus ::= INTEGER {
  granted                (0),
  grantedWithMods        (1),
  rejection              (2),
  waiting                (3),
  revocationWarning      (4),
  revocationNotification (5)
}
```

**–î–ª—è —É—Å–ø–µ—à–Ω–æ–≥–æ –æ—Ç–≤–µ—Ç–∞:**
- `status = 0` (granted)
- `timeStampToken` —Å–æ–¥–µ—Ä–∂–∏—Ç `SignedData` —Å `TSTInfo`

**–í–Ω—É—Ç—Ä–µ–Ω–Ω—è—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ `TSTInfo`:**

```asn1
TSTInfo ::= SEQUENCE {
  version        INTEGER { v1(1) },
  policy         TSAPolicyId,
  messageImprint MessageImprint,
  serialNumber   INTEGER,
  genTime        GeneralizedTime,
  nonce          INTEGER OPTIONAL
}

MessageImprint ::= SEQUENCE {
  hashAlgorithm  AlgorithmIdentifier,
  hashedMessage  OCTET STRING
}
```

**–ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –ø—Ä–∏–º–µ—Ä `TSTInfo`:**

```json
{
  "version": 1,
  "policy": "1.2.3.4.5.6.7",
  "messageImprint": {
    "hashAlgorithm": "2.16.840.1.101.3.4.2.1", // SHA-256
    "hashedMessage": "<32 bytes>"
  },
  "serialNumber": 1,
  "genTime": "20260101000000Z",
  "nonce": 12345
}
```

---

## –ü—Ä–∏–º–µ—Ä –∏–º–ø–ª–µ–º–µ–Ω—Ç–∞—Ü–∏–∏ (–ø—Å–µ–≤–¥–æ–∫–æ–¥)

```typescript
class MockTSA {
  private privateKey: crypto.KeyObject;
  private certificate: Buffer;
  private readonly FIXED_TIME = new Date('2026-01-01T00:00:00Z');
  private readonly POLICY_OID = '1.2.3.4.5.6.7';

  constructor() {
    // –ó–∞–≥—Ä—É–∂–∞–µ–º —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∫–ª—é—á –∏ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç (hardcoded)
    this.privateKey = loadFixedPrivateKey();
    this.certificate = loadFixedCertificate();
  }

  respond(request: TimeStampReq): TimeStampResp {
    // 1. –ò–∑–≤–ª–µ–∫–∞–µ–º –¥–∞–Ω–Ω—ã–µ –∏–∑ –∑–∞–ø—Ä–æ—Å–∞
    const messageImprint = request.messageImprint;
    const nonce = request.nonce || 0;

    // 2. –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –¥–µ—Ç–µ—Ä–º–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–π serialNumber
    const serial = this.computeSerial(messageImprint, nonce);

    // 3. –°–æ–∑–¥–∞—ë–º TSTInfo
    const tstInfo: TSTInfo = {
      version: 1,
      policy: this.POLICY_OID,
      messageImprint: messageImprint,
      serialNumber: serial,
      genTime: this.FIXED_TIME,
      nonce: nonce
    };

    // 4. –ö–æ–¥–∏—Ä—É–µ–º TSTInfo –≤ ASN.1 DER
    const tstInfoDER = encodeASN1(tstInfo);

    // 5. –ü–æ–¥–ø–∏—Å—ã–≤–∞–µ–º –¥–µ—Ç–µ—Ä–º–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω–æ (RSA PKCS#1 v1.5)
    const signedData = this.signDeterministic(tstInfoDER);

    // 6. –£–ø–∞–∫–æ–≤—ã–≤–∞–µ–º –≤ TimeStampResp
    const response: TimeStampResp = {
      status: {
        status: 0, // granted
        statusString: 'Operation Okay'
      },
      timeStampToken: signedData
    };

    return response;
  }

  private computeSerial(imprint: Buffer, nonce: number): bigint {
    // –î–µ—Ç–µ—Ä–º–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–π serial –∏–∑ —Ö–µ—à–∞ –≤—Ö–æ–¥–∞
    const hash = crypto.createHash('sha256')
      .update(imprint)
      .update(Buffer.from(nonce.toString()))
      .digest();
    
    return BigInt('0x' + hash.slice(0, 8).toString('hex'));
  }

  private signDeterministic(data: Buffer): Buffer {
    // RSA PKCS#1 v1.5 ‚Äî –¥–µ—Ç–µ—Ä–º–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –ø–æ–¥–ø–∏—Å—å
    const signature = crypto.sign(
      'sha256',
      data,
      {
        key: this.privateKey,
        padding: crypto.constants.RSA_PKCS1_PADDING
      }
    );

    // –£–ø–∞–∫–æ–≤—ã–≤–∞–µ–º –≤ SignedData (CMS ContentInfo)
    return createSignedData(data, signature, this.certificate);
  }
}
```

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:**

```typescript
const mockTSA = new MockTSA();

// –ó–∞–ø—Ä–æ—Å 1
const request1 = createTimeStampRequest(hash1, nonce1);
const response1 = mockTSA.respond(request1);

// –ó–∞–ø—Ä–æ—Å 2 (—Å —Ç–µ–º–∏ –∂–µ hash –∏ nonce)
const request2 = createTimeStampRequest(hash1, nonce1);
const response2 = mockTSA.respond(request2);

// response1 === response2 (–ø–æ–±–∞–π—Ç–æ–≤–æ –∏–¥–µ–Ω—Ç–∏—á–Ω—ã!)
assert(response1.equals(response2));
```

---

## –ß—Ç–æ –º–æ–∂–Ω–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å —Å MOCK_TSA

–° –¥–µ—Ç–µ—Ä–º–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–º MOCK_TSA —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è –≤–æ–∑–º–æ–∂–Ω—ã–º:

| –¢–µ—Å—Ç | –û–ø–∏—Å–∞–Ω–∏–µ |
|------|----------|
| ‚úÖ **Timestamp verification** | –ü—Ä–æ–≤–µ—Ä–∫–∞, —á—Ç–æ –∫–æ–¥ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –≤–µ—Ä–∏—Ñ–∏—Ü–∏—Ä—É–µ—Ç RFC 3161 —Ç–æ–∫–µ–Ω—ã |
| ‚úÖ **ASN.1 parsing** | –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–∞—Ä—Å–∏–Ω–≥–∞ `TSTInfo`, `SignedData`, `ContentInfo` |
| ‚úÖ **Chain validation logic** | –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–≥–∏–∫–∏ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ —Ü–µ–ø–æ—á–∫–∏ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤ (–Ω–∞ —Ñ–∏–∫—Ç–∏–≤–Ω–æ–º cert) |
| ‚úÖ **RFC 3161 handling** | –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç–∏ –∑–∞–ø—Ä–æ—Å–æ–≤/–æ—Ç–≤–µ—Ç–æ–≤ |
| ‚úÖ **Signature verification** | –ü—Ä–æ–≤–µ—Ä–∫–∞ RSA PKCS#1 v1.5 –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏–∏ |
| ‚úÖ **Determinism** | –ì–∞—Ä–∞–Ω—Ç–∏—è, —á—Ç–æ –¥–≤–∞ –æ–¥–∏–Ω–∞–∫–æ–≤—ã—Ö –∑–∞–ø—Ä–æ—Å–∞ –¥–∞—é—Ç –∏–¥–µ–Ω—Ç–∏—á–Ω—ã–π –æ—Ç–≤–µ—Ç |
| ‚úÖ **Regression tests** | –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ "golden vectors" (—ç—Ç–∞–ª–æ–Ω–Ω—ã—Ö —Ç–æ–∫–µ–Ω–æ–≤) –¥–ª—è —Å—Ä–∞–≤–Ω–µ–Ω–∏—è |

**–ü—Ä–∏–º–µ—Ä —Ä–µ–≥—Ä–µ—Å—Å–∏–æ–Ω–Ω–æ–≥–æ —Ç–µ—Å—Ç–∞:**

```typescript
test('MOCK_TSA returns identical token for same input', () => {
  const mockTSA = new MockTSA();
  const hash = sha256('Hello, Aletheia!');
  const nonce = 42;

  const token1 = mockTSA.respond({ hash, nonce });
  const token2 = mockTSA.respond({ hash, nonce });

  expect(token1).toEqual(token2); // –ü–æ–±–∞–π—Ç–æ–≤–æ –∏–¥–µ–Ω—Ç–∏—á–Ω—ã
});
```

---

## –ö–ª—é—á–µ–≤–∞—è —Ñ–∏–ª–æ—Å–æ—Ñ–∏—è

**MOCK_TSA –Ω–µ –¥–æ–∫–∞–∑—ã–≤–∞–µ—Ç –≤—Ä–µ–º—è.**

**MOCK_TSA –¥–æ–∫–∞–∑—ã–≤–∞–µ—Ç, —á—Ç–æ –∫–æ–¥ —Ä–∞–±–æ—Ç–∞–µ—Ç.**

### –†–∞–∑–Ω–∏—Ü–∞ –≤ —Ü–µ–ª—è—Ö

| –¶–µ–ª—å | –†–µ–∞–ª—å–Ω—ã–π TSA | MOCK_TSA |
|------|--------------|----------|
| –î–æ–∫–∞–∑–∞—Ç—å, —á—Ç–æ —Å–æ–±—ã—Ç–∏–µ –ø—Ä–æ–∏–∑–æ—à–ª–æ –≤ –æ–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω—ã–π –º–æ–º–µ–Ω—Ç –≤—Ä–µ–º–µ–Ω–∏ | ‚úÖ –î–∞ | ‚ùå –ù–µ—Ç |
| –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –ª–æ–≥–∏–∫—É –æ–±—Ä–∞–±–æ—Ç–∫–∏ RFC 3161 —Ç–æ–∫–µ–Ω–æ–≤ | ‚ùå –ü–ª–æ—Ö–æ –ø–æ–¥—Ö–æ–¥–∏—Ç (flaky, –Ω–µ–¥–µ—Ç–µ—Ä–º–∏–Ω–∏—Ä–æ–≤–∞–Ω) | ‚úÖ –ò–¥–µ–∞–ª—å–Ω–æ |
| –û–±–µ—Å–ø–µ—á–∏—Ç—å –ø–æ–≤—Ç–æ—Ä—è–µ–º–æ—Å—Ç—å —Ç–µ—Å—Ç–æ–≤ | ‚ùå –ù–µ–≤–æ–∑–º–æ–∂–Ω–æ | ‚úÖ –ì–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–æ |

**–í—ã–≤–æ–¥:** MOCK_TSA ‚Äî —ç—Ç–æ **—Ç–µ—Å—Ç–æ–≤—ã–π –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç**, –∞ –Ω–µ –∑–∞–º–µ–Ω–∞ —Ä–µ–∞–ª—å–Ω–æ–º—É TSA –≤ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ.

---

## –û—Ç–ª–∏—á–∏—è –æ—Ç —Ä–µ–∞–ª—å–Ω–æ–≥–æ TSA

| –•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∞ | –†–µ–∞–ª—å–Ω—ã–π TSA | MOCK_TSA |
|----------------|--------------|----------|
| **–í—Ä–µ–º—è** | –†–µ–∞–ª—å–Ω–æ–µ (`Date.now()`) | –§–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ (`2026-01-01T00:00:00Z`) |
| **–ö–ª—é—á–∏** | HSM, –∑–∞—â–∏—â—ë–Ω–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ | In-memory, hardcoded |
| **–ü–æ–¥–ø–∏—Å—å** | –ú–æ–∂–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å randomness (PSS, padding) | –î–µ—Ç–µ—Ä–º–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω–∞—è (RSA PKCS#1 v1.5) |
| **–°–µ—Ç—å** | –¢—Ä–µ–±—É–µ—Ç HTTP/HTTPS endpoint | –õ–æ–∫–∞–ª—å–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è (in-process) |
| **–°—Ç–æ–∏–º–æ—Å—Ç—å** | –ö–æ–º–º–µ—Ä—á–µ—Å–∫–∏–µ TSA –¥–æ—Ä–æ–≥–∏ | –ë–µ—Å–ø–ª–∞—Ç–Ω–æ |
| **–¢–µ—Å—Ç—ã** | Flaky (–≤—Ä–µ–º—è –º–µ–Ω—è–µ—Ç—Å—è) | Perfect (–≤—Å–µ–≥–¥–∞ –æ–¥–∏–Ω–∞–∫–æ–≤—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç) |
| **–î–æ–≤–µ—Ä–∏–µ** | –ú–æ–∂–Ω–æ –¥–æ–≤–µ—Ä—è—Ç—å –≤—Ä–µ–º–µ–Ω–∏ | –ù–µ–ª—å–∑—è –¥–æ–≤–µ—Ä—è—Ç—å –≤—Ä–µ–º–µ–Ω–∏ (—Ñ–∏–∫—Ç–∏–≤–Ω–æ–µ) |
| **–Æ—Ä–∏–¥–∏—á–µ—Å–∫–∞—è —Å–∏–ª–∞** | –ò–º–µ–µ—Ç (–µ—Å–ª–∏ –∫–≤–∞–ª–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω, eIDAS) | –ù–µ –∏–º–µ–µ—Ç |

---

## –ü–∞—Ç—Ç–µ—Ä–Ω: Cryptographic Test Oracle

MOCK_TSA ‚Äî —ç—Ç–æ –ø—Ä–∏–º–µ—Ä –æ—á–µ–Ω—å —Å–∏–ª—å–Ω–æ–≥–æ –ø–∞—Ç—Ç–µ—Ä–Ω–∞ –≤ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏ –∫—Ä–∏–ø—Ç–æ–≥—Ä–∞—Ñ–∏–∏:

**Cryptographic Test Oracle**

**–û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ:** –î–µ—Ç–µ—Ä–º–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –∏–º–ø–ª–µ–º–µ–Ω—Ç–∞—Ü–∏—è –∫—Ä–∏–ø—Ç–æ–≥—Ä–∞—Ñ–∏—á–µ—Å–∫–æ–≥–æ –ø—Ä–æ—Ç–æ–∫–æ–ª–∞, –∫–æ—Ç–æ—Ä–∞—è:
- –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –≤–∞–ª–∏–¥–Ω—ã–µ (–Ω–æ —Ñ–∏–∫—Ç–∏–≤–Ω—ã–µ) –∫—Ä–∏–ø—Ç–æ–≥—Ä–∞—Ñ–∏—á–µ—Å–∫–∏–µ –∞—Ä—Ç–µ—Ñ–∞–∫—Ç—ã
- –ì–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç –∏–¥–µ–Ω—Ç–∏—á–Ω—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç –¥–ª—è –∏–¥–µ–Ω—Ç–∏—á–Ω–æ–≥–æ –≤—Ö–æ–¥–∞
- –ü–æ–∑–≤–æ–ª—è–µ—Ç —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ç–æ—Ä—ã –∏ –ø–∞—Ä—Å–µ—Ä—ã –±–µ–∑ –≤–Ω–µ—à–Ω–∏—Ö –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π

**–î—Ä—É–≥–∏–µ –ø—Ä–∏–º–µ—Ä—ã —ç—Ç–æ–≥–æ –ø–∞—Ç—Ç–µ—Ä–Ω–∞:**
- **MOCK CA** ‚Äî –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –≤—ã–¥–∞—á–∏ –∏ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ X.509 —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤
- **MOCK HSM** ‚Äî –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –æ–ø–µ—Ä–∞—Ü–∏–π —Å –∫–ª—é—á–∞–º–∏
- **MOCK OCSP Responder** ‚Äî –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –æ—Ç–∑—ã–≤–∞ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- –ü–æ–ª–Ω—ã–π –∫–æ–Ω—Ç—Ä–æ–ª—å –Ω–∞–¥ —Ç–µ—Å—Ç–æ–≤–æ–π —Å—Ä–µ–¥–æ–π
- –î–µ—Ç–µ—Ä–º–∏–Ω–∏–∑–º –∏ –ø–æ–≤—Ç–æ—Ä—è–µ–º–æ—Å—Ç—å
- –ë—ã—Å—Ç—Ä–æ—Ç–∞ (–Ω–µ—Ç —Å–µ—Ç–∏, –Ω–µ—Ç –≤–Ω–µ—à–Ω–∏—Ö –≤—ã–∑–æ–≤–æ–≤)
- –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å —Å–æ–∑–¥–∞—Ç—å "golden vectors" –¥–ª—è —Ä–µ–≥—Ä–µ—Å—Å–∏–æ–Ω–Ω—ã—Ö —Ç–µ—Å—Ç–æ–≤

---

## –ò–º–ø–ª–µ–º–µ–Ω—Ç–∞—Ü–∏—è –Ω–∞ Java (Bouncy Castle)

–í –ø—Ä–æ–µ–∫—Ç–µ Aletheia AI –±—ç–∫–µ–Ω–¥ –Ω–∞–ø–∏—Å–∞–Ω –Ω–∞ **Java (Spring Boot)**. MOCK_TSA –≤ Java ‚Äî –æ—Å–Ω–æ–≤–Ω–æ–π –ø—É—Ç—å —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –¥–ª—è Task 2.4 (TimestampService): –æ–¥–∏–Ω —Å—Ç–µ–∫, –æ–¥–Ω–∞ –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ (Bouncy Castle), –ø–æ–ª–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Å —Ä–µ–∞–ª—å–Ω—ã–º–∏ TSA (–≤ —Ç.—á. EJBCA).

### –ü–æ—á–µ–º—É Java –¥–ª—è Aletheia

**–í Java —É–∂–µ –µ—Å—Ç—å –ø–æ—á—Ç–∏ –≤—Å—ë –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ–µ** ‚Äî —á–µ—Ä–µ–∑ Bouncy Castle:

| –ö–æ–º–ø–æ–Ω–µ–Ω—Ç | Bouncy Castle |
|-----------|----------------|
| RFC 3161 | `TimeStampRequest`, `TimeStampResponse`, `TimeStampTokenGenerator`, `TimeStampResponseGenerator` |
| ASN.1 | –í—Å—Ç—Ä–æ–µ–Ω–Ω–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞ –≤ `org.bouncycastle.asn1` |
| CMS / PKCS#7 | –ü–æ–¥–ø–∏—Å—å –∏ —É–ø–∞–∫–æ–≤–∫–∞ —Ç–æ–∫–µ–Ω–∞ |
| X.509 | –°–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã –¥–ª—è TSA |
| RSA PKCS#1 v1.5 | `SHA256withRSA` ‚Äî –¥–µ—Ç–µ—Ä–º–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –ø–æ–¥–ø–∏—Å—å |

**–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–ª—é—Å—ã:**
- **EJBCA –Ω–∞–ø–∏—Å–∞–Ω –Ω–∞ Java** ‚Äî —Ç–æ—Ç –∂–µ –∫–æ–Ω—Ü–µ–ø—Ç—É–∞–ª—å–Ω—ã–π –º–∏—Ä (RFC 3161, ASN.1, CMS). MOCK_TSA –º–æ–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å drop-in replacement –¥–ª—è —Ç–µ—Å—Ç–æ–≤ –≤–º–µ—Å—Ç–æ EJBCA TSA.
- **–û–¥–∏–Ω —Å—Ç–µ–∫ –¥–ª—è –±—ç–∫–µ–Ω–¥–∞ –∏ —Ç–µ—Å—Ç–æ–≤** ‚Äî –Ω–µ –Ω—É–∂–Ω—ã –æ—Ç–¥–µ–ª—å–Ω—ã–µ —Å–∫—Ä–∏–ø—Ç—ã –∏–ª–∏ —Å–µ—Ä–≤–∏—Å—ã.
- **JUnit + Spring Test** ‚Äî MOCK_TSA –∫–∞–∫ bean –∏–ª–∏ –æ–±—ã—á–Ω—ã–π —Å–µ—Ä–≤–∏—Å, –∏–Ω–∂–µ–∫—Ç–∏—Ç—Å—è –≤ —Ç–µ—Å—Ç—ã –±–µ–∑ HTTP.

### –ö–æ–Ω—Ç—Ä–∞–∫—Ç: –±–µ–∑ —Å–µ—Ç–∏, —Ç–æ–ª—å–∫–æ —Å–µ—Ä–≤–∏—Å

–í Java MOCK_TSA ‚Äî —ç—Ç–æ **–æ–±—ã—á–Ω—ã–π —Å–µ—Ä–≤–∏—Å**, –±–µ–∑ HTTP, HSM –∏ NTP:

```
TimeStampRequest (byte[] tsq)  ‚Üí  MockTsaService  ‚Üí  TimeStampResponse (byte[] tsr)
```

**–ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å:**

```java
public class MockTsaService {

    private final PrivateKey tsaKey;
    private final X509Certificate tsaCert;
    private final Date fixedTime;

    public MockTsaService(PrivateKey tsaKey, X509Certificate tsaCert) {
        this.tsaKey = tsaKey;
        this.tsaCert = tsaCert;
        this.fixedTime = Date.from(Instant.parse("2026-01-01T00:00:00Z"));
    }

    /**
     * –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç RFC 3161 –∑–∞–ø—Ä–æ—Å (TSQ bytes) –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –¥–µ—Ç–µ—Ä–º–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –æ—Ç–≤–µ—Ç (TSR bytes).
     */
    public byte[] respond(byte[] tsqBytes) throws Exception {
        TimeStampRequest req = new TimeStampRequest(tsqBytes);
        // ... build deterministic response
        return resp.getEncoded();
    }
}
```

–ù–∏–∫–∞–∫–æ–≥–æ HTTP: —Ç–µ—Å—Ç –≤—ã–∑—ã–≤–∞–µ—Ç `mockTsaService.respond(tsqBytes)` –∏ –ø–æ–ª—É—á–∞–µ—Ç `byte[]` TSR.

### –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

–í `pom.xml` (–∏–ª–∏ –∞–Ω–∞–ª–æ–≥ –¥–ª—è Gradle) –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ Bouncy Castle PKIX:

```xml
<dependency>
  <groupId>org.bouncycastle</groupId>
  <artifactId>bcpkix-jdk18on</artifactId>
  <version>1.78</version>
</dependency>
```

`bcpkix-jdk18on` —Ç—è–Ω–µ—Ç –∑–∞ —Å–æ–±–æ–π TSP (RFC 3161), CMS, X.509. –û—Ç–¥–µ–ª—å–Ω–æ –ø–æ–¥–∫–ª—é—á–∞—Ç—å `bouncy-castle` –¥–ª—è –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞ –Ω–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ, –µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—à—å —Ç–æ–ª—å–∫–æ –≤—ã—Å–æ–∫–æ—É—Ä–æ–≤–Ω–µ–≤—ã–µ API.

### –†–∞–±–æ—á–∞—è –ª–æ–≥–∏–∫–∞ —Å Bouncy Castle

–ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è —Ä–∞–±–æ—á–∞—è —Ü–µ–ø–æ—á–∫–∞: **–≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä —Ç–æ–∫–µ–Ω–∞** (—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∫–ª—é—á + SHA256withRSA) ‚Üí **–≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä –æ—Ç–≤–µ—Ç–∞** ‚Üí –≤—ã–∑–æ–≤ —Å **—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–º –≤—Ä–µ–º–µ–Ω–µ–º –∏ –¥–µ—Ç–µ—Ä–º–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–º serial**.

**–í–∞–∂–Ω–æ:** –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å **—Ç–æ–ª—å–∫–æ** `SHA256withRSA` (RSA PKCS#1 v1.5). –ù–µ RSA-PSS, –Ω–µ ECDSA ‚Äî –∏–Ω–∞—á–µ –ø–æ–¥–ø–∏—Å—å –±—É–¥–µ—Ç –Ω–µ–¥–µ—Ç–µ—Ä–º–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω–æ–π –∏ —Ç–µ—Å—Ç—ã –Ω–∞—á–Ω—É—Ç ¬´—Ñ–ª–∞–ø–∞—Ç—å¬ª.

**–§–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –≤—Ä–µ–º—è ‚Äî —Ç–æ–ª—å–∫–æ –∏–∑ –∫–æ–Ω—Å—Ç–∞–Ω—Ç—ã:**

```java
Instant fixedInstant = Instant.parse("2026-01-01T00:00:00Z");
Date genTime = Date.from(fixedInstant);
// –ù–∏–∫–æ–≥–¥–∞: new Date() –∏–ª–∏ Instant.now()
```

**–î–µ—Ç–µ—Ä–º–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–π serialNumber** ‚Äî –Ω–∞–ø—Ä–∏–º–µ—Ä, –∏–∑ —Ö–µ—à–∞ message imprint:

```java
byte[] digest = req.getMessageImprintDigest();
byte[] hash = MessageDigest.getInstance("SHA-256").digest(digest);
BigInteger serial = new BigInteger(1, Arrays.copyOf(hash, 8));
```

–ò–ª–∏ –¥–ª—è –ø—Ä–æ—Å—Ç—ã—Ö —Ç–µ—Å—Ç–æ–≤: `BigInteger.ONE`.

**–°–±–æ—Ä–∫–∞ –æ—Ç–≤–µ—Ç–∞ (–ø—Å–µ–≤–¥–æ–∫–æ–¥ —Ä–∞–±–æ—á–µ–π –ª–æ–≥–∏–∫–∏):**

```java
// 1. –ü–æ–¥–ø–∏—Å—å ‚Äî —Ç–æ–ª—å–∫–æ SHA256withRSA (–¥–µ—Ç–µ—Ä–º–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω–æ)
ContentSigner signer = new JcaContentSignerBuilder("SHA256withRSA").build(tsaPrivateKey);
JcaDigestCalculatorProviderBuilder digestCalcBuilder = new JcaDigestCalculatorProviderBuilder().build();
SignerInfoGeneratorBuilder sigInfoGenBuilder = new JcaSignerInfoGeneratorBuilder(digestCalcBuilder.build());

// 2. –ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä —Ç–æ–∫–µ–Ω–∞ —Å —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–º —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–º –∏ policy OID
TimeStampTokenGenerator tokenGen = new TimeStampTokenGenerator(
    signer,
    sigInfoGenBuilder.build(tsaCert),
    new ASN1ObjectIdentifier("1.2.3.4.5.6")
);
tokenGen.addCertificates(new JcaCertStore(List.of(tsaCert)));

// 3. –ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä –æ—Ç–≤–µ—Ç–∞
TimeStampResponseGenerator respGen = new TimeStampResponseGenerator(tokenGen, TSPAlgorithms.ALLOWED);

// 4. Serial –∏ –≤—Ä–µ–º—è ‚Äî –¥–µ—Ç–µ—Ä–º–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ; fixedTime –ø–µ—Ä–µ–¥–∞—ë—Ç—Å—è –≤—Ä—É—á–Ω—É—é
TimeStampResponse resp = respGen.generate(request, serial, fixedTime);

return resp.getEncoded();
```

–°–∏–≥–Ω–∞—Ç—É—Ä—ã –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä–æ–≤ –∏ –∏–º–µ–Ω–∞ –∫–ª–∞—Å—Å–æ–≤ –º–æ–≥—É—Ç –æ—Ç–ª–∏—á–∞—Ç—å—Å—è –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –≤–µ—Ä—Å–∏–∏ Bouncy Castle; —Å–º. –ø—Ä–∏–º–µ—Ä—ã –≤ –ø–∞–∫–µ—Ç–µ `org.bouncycastle.tsp` –∏ –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω—É—é –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é BC.

–ö—Ä–∏—Ç–∏—á–Ω–æ: **`fixedTime` –∏ `serial` –ø–µ—Ä–µ–¥–∞—é—Ç—Å—è –≤—Ä—É—á–Ω—É—é** –≤ `generate(...)`, –∞ –Ω–µ –±–µ—Ä—É—Ç—Å—è –∏–∑ —Å–∏—Å—Ç–µ–º–Ω—ã—Ö —á–∞—Å–æ–≤ –∏–ª–∏ RNG.

### –ì–¥–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≤ –ø—Ä–æ–µ–∫—Ç–µ

- **Unit-—Ç–µ—Å—Ç—ã** `TimestampService`: –ø–æ–¥—Å—Ç–∞–≤–ª—è—Ç—å `MockTsaService` –≤–º–µ—Å—Ç–æ HTTP-–∫–ª–∏–µ–Ω—Ç–∞ –∫ —Ä–µ–∞–ª—å–Ω–æ–º—É TSA.
- **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã**: pipeline ¬´canonicalize ‚Üí hash ‚Üí sign ‚Üí timestamp¬ª –±–µ–∑ –≤–Ω–µ—à–Ω–µ–≥–æ TSA.
- **CI**: –±–µ–∑ —Å–µ—Ç–∏ –∏ –±–µ–∑ —Ñ–ª–∞–ø–æ–≤ ‚Äî –æ–¥–∏–Ω –∏ —Ç–æ—Ç –∂–µ TSQ –¥–∞—ë—Ç –æ–¥–∏–Ω –∏ —Ç–æ—Ç –∂–µ TSR.
- **–†–µ–≥—Ä–µ—Å—Å–∏—è**: —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ —Å —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—ã–º–∏ golden-—Ñ–∞–π–ª–∞–º–∏ (—Å–º. –Ω–∏–∂–µ).

### Golden fixtures (–±–∞–π—Ç-–≤-–±–∞–π—Ç)

–° –¥–µ—Ç–µ—Ä–º–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–º MOCK_TSA –º–æ–∂–Ω–æ –≥–æ–¥–∞–º–∏ –≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å **–æ–¥–∏–Ω –∏ —Ç–æ—Ç –∂–µ** `TimeStampToken` –¥–ª—è –æ–¥–Ω–æ–≥–æ –∏ —Ç–æ–≥–æ –∂–µ –≤—Ö–æ–¥–∞. –≠—Ç–æ –¥–∞—ë—Ç:

- –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —ç—Ç–∞–ª–æ–Ω–Ω–æ–≥–æ –æ—Ç–≤–µ—Ç–∞ –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, `src/test/resources/fixtures/tsr-golden.tsr`).
- –í —Ç–µ—Å—Ç–µ: —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å TSR —á–µ—Ä–µ–∑ `MockTsaService` –∏ —Å—Ä–∞–≤–Ω–∏—Ç—å —Å —ç—Ç–∞–ª–æ–Ω–æ–º: `assertArrayEquals(expectedTsr, actualTsr)`.
- –õ—é–±–æ–µ –∏–∑–º–µ–Ω–µ–Ω–∏–µ —Ñ–æ—Ä–º–∞—Ç–∞ –∏–ª–∏ –ª–æ–≥–∏–∫–∏ Bouncy Castle —Å—Ä–∞–∑—É –ª–æ–º–∞–µ—Ç —Ç–µ—Å—Ç ‚Äî —Ä–µ–¥–∫–∞—è —Ä–æ—Å–∫–æ—à—å –≤ –∫—Ä–∏–ø—Ç–æ–≥—Ä–∞—Ñ–∏—á–µ—Å–∫–æ–º –∫–æ–¥–µ.

**–ò–¥–µ—è —Ç–µ—Å—Ç–∞:**

```java
@Test
void mockTsaResponseMatchesGoldenFixture() throws Exception {
    byte[] tsq = readResource("fixtures/tsq-golden.tsq");
    byte[] expectedTsr = readResource("fixtures/tsr-golden.tsr");

    byte[] actualTsr = mockTsaService.respond(tsq);

    assertArrayEquals(expectedTsr, actualTsr);
}
```

---

## –î–∞–ª—å–Ω–µ–π—à–∏–µ —à–∞–≥–∏ (Task 2.4)

–ü–ª–∞–Ω –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ MOCK_TSA –≤ Aletheia AI –≤ —Ä–∞–º–∫–∞—Ö **vibe coding Task 2.4** (TimestampService):

### 1. –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å MockTsaService (Java)

- –ö–ª–∞—Å—Å `MockTsaService` —Å –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä–æ–º (private key + certificate, –∏–ª–∏ –∑–∞–≥—Ä—É–∑–∫–∞ –∏–∑ test resources).
- –ú–µ—Ç–æ–¥ `respond(byte[] tsqBytes)` ‚Üí `byte[] tsrBytes`.
- –§–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –≤—Ä–µ–º—è `2026-01-01T00:00:00Z`, –¥–µ—Ç–µ—Ä–º–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–π serial (–Ω–∞–ø—Ä–∏–º–µ—Ä, SHA-256 –æ—Ç message imprint, –ø–µ—Ä–≤—ã–µ 8 –±–∞–π—Ç), —Ç–æ–ª—å–∫–æ `SHA256withRSA`.
- JUnit-—Ç–µ—Å—Ç—ã: –æ–¥–∏–Ω–∞–∫–æ–≤—ã–π –∑–∞–ø—Ä–æ—Å ‚Üí –æ–¥–∏–Ω–∞–∫–æ–≤—ã–π –æ—Ç–≤–µ—Ç; –ø–∞—Ä—Å–∏–Ω–≥ TSR –∏ –ø—Ä–æ–≤–µ—Ä–∫–∞ genTime/serial.

### 2. –ü–æ–¥–∫–ª—é—á–∏—Ç—å –∫–∞–∫ Spring Bean (—Ç–æ–ª—å–∫–æ –¥–ª—è —Ç–µ—Å—Ç–æ–≤)

- –ü—Ä–æ—Ñ–∏–ª—å `@Profile("test")` –∏–ª–∏ —Ç–µ—Å—Ç–æ–≤—ã–π –∫–æ–Ω—Ç–µ–∫—Å—Ç: –±–∏–Ω `MockTsaService` —Ä–µ–∞–ª–∏–∑—É–µ—Ç —Ç–æ—Ç –∂–µ –∫–æ–Ω—Ç—Ä–∞–∫—Ç, —á—Ç–æ –∏ ¬´–ø–æ–ª—É—á–µ–Ω–∏–µ TSR –ø–æ TSQ¬ª (–Ω–∞–ø—Ä–∏–º–µ—Ä, –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å `TsaClient` –∏–ª–∏ –∞–Ω–∞–ª–æ–≥–∏—á–Ω—ã–π).
- –í —Ç–µ—Å—Ç–∞—Ö `TimestampService` –∏–Ω–∂–µ–∫—Ç–∏—Ç—å —ç—Ç–æ—Ç –±–∏–Ω –≤–º–µ—Å—Ç–æ HTTP-–∫–ª–∏–µ–Ω—Ç–∞ –∫ —Ä–µ–∞–ª—å–Ω–æ–º—É TSA ‚Äî –Ω–∏–∫–∞–∫–∏—Ö –≤–Ω–µ—à–Ω–∏—Ö –≤—ã–∑–æ–≤–æ–≤.

### 3. RFC 3161 test vectors

**RFC 3161 test vectors** ‚Äî —ç—Ç–æ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ –ø—Ä–∏–º–µ—Ä—ã –∑–∞–ø—Ä–æ—Å–æ–≤ –∏ –æ—Ç–≤–µ—Ç–æ–≤ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ Time-Stamp Protocol (TSP):

**–ß—Ç–æ –≤–∫–ª—é—á–∞—é—Ç:**
- –ó–∞–¥–∞–Ω–Ω—ã–π —Ö–µ—à/–¥–∞–π–¥–∂–µ—Å—Ç (–≤—Ö–æ–¥–Ω–æ–π –ø–∞—Ä–∞–º–µ—Ç—Ä)
- –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–π TSA –æ—Ç–≤–µ—Ç (—Ç–æ–∫–µ–Ω TimeStampToken)
- –û–∂–∏–¥–∞–µ–º—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è: timestamp, signatures, serial numbers, policy OIDs
- –í–∞–ª–∏–¥–Ω—ã–µ —Å–ª—É—á–∞–∏ –∏ edge cases (–Ω–µ–≤–∞–ª–∏–¥–Ω—ã–µ —Ö–µ—à–∏, –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –∞–ª–≥–æ—Ä–∏—Ç–º—ã, –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã)

**–ü—Ä–∏–º–µ—Ä —Å—Ç—Ä—É–∫—Ç—É—Ä—ã test vector:**

```json
{
  "description": "Valid SHA-256 timestamp request",
  "input": {
    "hash_algorithm": "SHA-256",
    "digest": "3a7bd3e2360a3d29eea436fcfb7e44c735d117c42d1c1835420b6b9942dd4f1b",
    "nonce": 12345,
    "policy_oid": "1.2.3.4.5.6.7.8"
  },
  "expected_output": {
    "status": "granted",
    "tst_token_base64": "MIIC...ABC123",
    "gen_time": "2026-01-01T00:00:00Z",
    "serial_number": "0x01a2b3c4d5e6f7",
    "policy": "1.2.3.4.5.6.7.8"
  }
}
```

**–ò–º–ø–ª–µ–º–µ–Ω—Ç–∞—Ü–∏—è –≤ Aletheia:**

- –°–æ–∑–¥–∞—Ç—å –∫–æ–ª–ª–µ–∫—Ü–∏—é test vectors –≤ `src/test/resources/rfc3161-vectors/`
- –§–∞–π–ª—ã: `valid-sha256.json`, `invalid-hash.json`, `missing-nonce.json` –∏ —Ç.–¥.
- JUnit-—Ç–µ—Å—Ç—ã —á–∏—Ç–∞—é—Ç vector, –≤—ã–∑—ã–≤–∞—é—Ç `MockTsaService`, —Å—Ä–∞–≤–Ω–∏–≤–∞—é—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç

**–ü—Ä–∏–º–µ—Ä —Ç–µ—Å—Ç–∞:**

```java
@ParameterizedTest
@JsonFileSource("classpath:rfc3161-vectors/valid-vectors.json")
void mockTsaMatchesRfc3161Vector(Rfc3161Vector vector) throws Exception {
    TimeStampRequest tsq = createTSQ(vector.getDigest(), vector.getNonce());
    TimeStampResponse tsr = mockTsaService.respond(tsq.getEncoded());
    
    // Parse and validate
    TimeStampToken token = tsr.getTimeStampToken();
    assertEquals(vector.getExpectedTime(), token.getTimeStampInfo().getGenTime());
    assertEquals(vector.getExpectedSerial(), token.getTimeStampInfo().getSerialNumber());
}
```

### 4. Golden fixtures —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

**Golden fixtures** ‚Äî —ç—Ç–æ –∏–∑–≤–µ—Å—Ç–Ω—ã–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ –≤—ã—Ö–æ–¥—ã, –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –∫–∞–∫ —ç—Ç–∞–ª–æ–Ω –≤ –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö —Ç–µ—Å—Ç–∞—Ö.

**–î–ª—è timestamping:**
- –ë–µ—Ä—ë–º –¥–∞–π–¥–∂–µ—Å—Ç, –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º –≤ TSA (–∏–ª–∏ stub), —Å—Ä–∞–≤–Ω–∏–≤–∞–µ–º —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Ç–æ–∫–µ–Ω —Å golden fixture
- –ï—Å–ª–∏ —Ç–æ–∫–µ–Ω —Å–æ–≤–ø–∞–¥–∞–µ—Ç —Å fixture ‚Äî –∫–æ–¥ —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- –ü–æ–º–æ–≥–∞—é—Ç –≤ **regression testing**: –µ—Å–ª–∏ –±—É–¥—É—â–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å–ª–æ–º–∞—é—Ç –ª–æ–≥–∏–∫—É timestamping, —Ç–µ—Å—Ç—ã —É–ø–∞–¥—É—Ç

**–ü—Ä–∏–º–µ—Ä golden fixture:**

```json
{
  "name": "hello-world-timestamp",
  "description": "Timestamp for 'hello world' text",
  "input": {
    "text": "hello world",
    "canonical": "hello world",
    "digest_sha256": "b94d27b9934d3e08a52e52d7da7dabfac484efe37a5380ee9088f7ace2efcde9"
  },
  "tst_token_base64": "MIIC...",
  "tst_token_file": "fixtures/hello-world.tsr",
  "metadata": {
    "generated_at": "2026-01-01T00:00:00Z",
    "generator": "MockTsaService v1.0",
    "bouncy_castle_version": "1.78"
  }
}
```

**–°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è golden fixtures:**

```
aletheia-ai/rfc3161-test-vectors/
  ‚îú‚îÄ‚îÄ vectors/
  ‚îÇ   ‚îú‚îÄ‚îÄ valid-sha256.json
  ‚îÇ   ‚îú‚îÄ‚îÄ invalid-hash.json
  ‚îÇ   ‚îî‚îÄ‚îÄ edge-cases.json
  ‚îú‚îÄ‚îÄ golden/
  ‚îÇ   ‚îú‚îÄ‚îÄ hello-world.tsr
  ‚îÇ   ‚îú‚îÄ‚îÄ hello-world.tsq
  ‚îÇ   ‚îî‚îÄ‚îÄ metadata.json
  ‚îî‚îÄ‚îÄ README.md
```

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –æ—Ç–¥–µ–ª—å–Ω–æ–≥–æ —Ä–µ–ø–æ:**
- –ü–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≤ –¥—Ä—É–≥–∏—Ö —è–∑—ã–∫–∞—Ö/–ø—Ä–æ–µ–∫—Ç–∞—Ö (Node.js, Python, Go)
- –°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Å EJBCA/–¥—Ä—É–≥–∏–º–∏ TSA –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏
- –ü—É–±–ª–∏—á–Ω—ã–µ —Ç–µ—Å—Ç—ã –¥–ª—è —Å–æ–æ–±—â–µ—Å—Ç–≤–∞ (–∫–∞–∫ —É BouncyCastle)
- –í–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ test vectors –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ –æ—Ç –∫–æ–¥–∞

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:**

```java
@Test
void timestampMatchesGoldenFixture() throws Exception {
    // Load golden fixture
    GoldenFixture fixture = loadFixture("hello-world");
    byte[] expectedTsr = Files.readAllBytes(Paths.get(fixture.getTsrFile()));
    
    // Generate token
    byte[] digest = fixture.getDigest();
    byte[] actualTsr = mockTsaService.respond(createTSQ(digest));
    
    // Compare byte-by-byte
    assertArrayEquals(expectedTsr, actualTsr, 
        "Timestamp token differs from golden fixture");
}
```

**–ü—É–±–ª–∏—á–Ω—ã–µ –∏—Å—Ç–æ—á–Ω–∏–∫–∏ RFC 3161 test vectors:**
- **BouncyCastle** ‚Äî –≤–∫–ª—é—á–∞–µ—Ç test vectors –≤ `tsp` test suites
- **Open-source TSA —Å–µ—Ä–≤–µ—Ä—ã** ‚Äî —á–∞—Å—Ç–æ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç fixture JSON –∏–ª–∏ DER —Ñ–∞–π–ª—ã
- **IETF/RFC test suites** ‚Äî —ç—Ç–∞–ª–æ–Ω–Ω—ã–µ –ø—Ä–∏–º–µ—Ä—ã –∏–∑ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–æ–≤

**–¶–µ–ª—å:** –õ—é–±–æ–π, –∫—Ç–æ –∏–º–ø–ª–µ–º–µ–Ω—Ç–∏—Ä—É–µ—Ç RFC 3161, –º–æ–∂–µ—Ç –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–≤–æ–π client/server –ø—Ä–æ—Ç–∏–≤ —ç—Ç–∏—Ö known-good –ø—Ä–∏–º–µ—Ä–æ–≤.

### 5. Drop-in –∑–∞–º–µ–Ω–∞ —Ä–µ–∞–ª—å–Ω–æ–º—É TSA –≤ —Ç–µ—Å—Ç–∞—Ö

- –í –ø—Ä–æ–¥–µ: `TimestampService` —Ö–æ–¥–∏—Ç –ø–æ HTTP –∫ –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º–æ–º—É TSA URL (EJBCA, FreeTSA –∏ —Ç.–¥.).
- –í —Ç–µ—Å—Ç–∞—Ö: —Ç–æ—Ç –∂–µ `TimestampService`, –Ω–æ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å ¬´–ø–æ–ª—É—á–∏—Ç—å TSR¬ª —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ —á–µ—Ä–µ–∑ `MockTsaService` ‚Äî –±–µ–∑ —Å–º–µ–Ω—ã –∫–æ–¥–∞ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞, —Ç–æ–ª—å–∫–æ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —Ç–µ—Å—Ç–æ–≤–æ–≥–æ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞.

### 6. –°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Å —Ä–µ–∞–ª—å–Ω—ã–º TSA (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

- –ì–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –æ–¥–∏–Ω –∏ —Ç–æ—Ç –∂–µ TSQ, –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å –≤ EJBCA TSA –∏ –≤ `MockTsaService`; —Å—Ä–∞–≤–Ω–∏–≤–∞—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä—É –æ—Ç–≤–µ—Ç–∞ (ASN.1, –ø–æ–ª—è TSTInfo), –∞ –Ω–µ –±–∞–π—Ç—ã (–≤—Ä–µ–º—è –∏ –ø–æ–¥–ø–∏—Å—å —É —Ä–µ–∞–ª—å–Ω–æ–≥–æ TSA –¥—Ä—É–≥–∏–µ). –ù—É–∂–Ω–æ –¥–ª—è —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç–∏, —á—Ç–æ –Ω–∞—à MOCK_TSA –∏ —Ä–µ–∞–ª—å–Ω—ã–π TSA –≥–æ–≤–æ—Ä—è—Ç –Ω–∞ –æ–¥–Ω–æ–º –ø—Ä–æ—Ç–æ–∫–æ–ª–µ.

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç –¥–ª—è Task 2.4:** –ø—É–Ω–∫—Ç—ã 1 ‚Üí 2 ‚Üí 5 (MockTsaService, Spring-–±–∏–Ω –¥–ª—è —Ç–µ—Å—Ç–æ–≤, drop-in –≤ —Ç–µ—Å—Ç–∞—Ö). –ü—É–Ω–∫—Ç—ã 3, 4, 6 ‚Äî –ø–æ –∂–µ–ª–∞–Ω–∏—é –¥–ª—è —É—Å–∏–ª–µ–Ω–∏—è —Ä–µ–≥—Ä–µ—Å—Å–∏–∏ –∏ —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏.

---

## –°–≤—è–∑–∞–Ω–Ω—ã–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã

- [–í—Ä–µ–º–µ–Ω–Ω—ã–µ –º–µ—Ç–∫–∏ (TIMESTAMPING)](TIMESTAMPING.md) ‚Äî RFC 3161, TSA endpoint, —á—Ç–æ –º–µ—Ç–∏–º –ø–æ –≤—Ä–µ–º–µ–Ω–∏
- [–ü–æ–¥–ø–∏—Å—å (SIGNING)](SIGNING.md) ‚Äî –∞–ª–≥–æ—Ä–∏—Ç–º—ã –ø–æ–¥–ø–∏—Å–∏, –¥–µ—Ç–µ—Ä–º–∏–Ω–∏–∑–º RSA PKCS#1 v1.5
- [–ú–æ–¥–µ–ª—å –¥–æ–≤–µ—Ä–∏—è (TRUST_MODEL)](TRUST_MODEL.md) ‚Äî –∫—Ç–æ —á—Ç–æ —É–¥–æ—Å—Ç–æ–≤–µ—Ä—è–µ—Ç, –ø–æ—á–µ–º—É TSA –≤–∞–∂–µ–Ω
- [–ü–ª–∞–Ω –∏–º–ø–ª–µ–º–µ–Ω—Ç–∞—Ü–∏–∏ (PLAN)](PLAN.md) ‚Äî –ó–∞–¥–∞—á–∞ 2.4: TimestampService (–≥–¥–µ –±—É–¥–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è MOCK_TSA)
- [–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ –¥–∏–∞–≥—Ä–∞–º–º—ã](../../diagrams/architecture.md) ‚Äî pipeline —Å timestamp —à–∞–≥–æ–º
- [README](../../README.md) ‚Äî –æ–±–∑–æ—Ä –ø—Ä–æ–µ–∫—Ç–∞ Aletheia AI

---

**–°—Ç–∞—Ç—É—Å:** –ö–æ–Ω—Ü–µ–ø—Ç—É–∞–ª—å–Ω—ã–π –¥–æ–∫—É–º–µ–Ω—Ç. –ò–º–ø–ª–µ–º–µ–Ω—Ç–∞—Ü–∏—è MOCK_TSA –∑–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∞ –≤ —Ä–∞–º–∫–∞—Ö Task 2.4 (TimestampService).

**–õ–∏—Ü–µ–Ω–∑–∏—è:** MIT (–≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–∏ —Å –ø—Ä–æ–µ–∫—Ç–æ–º Aletheia AI).
